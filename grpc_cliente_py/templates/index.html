<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Productos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
        }

        h1 {
            color: #4CAF50;
        }

        p {
            font-size: 18px;
        }

        table {
            width: 70%;
            margin: 20px auto;
            border-collapse: collapse;
        }

        table,
        th,
        td {
            border: 1px solid black;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
        }

        input[type="number"],
        input[type="text"] {
            width: 80px;
            padding: 5px;
        }

        button {
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        form {
            margin: 20px auto;
            text-align: left;
            width: 70%;
        }
    </style>
</head>

<body>
    <h1>Gestión de Productos</h1>

    <h2>Alta de Producto</h2>
    <form id="alta-producto-form">
        <table>
            <tr>
                <td><label for="codigo">Código:</label></td>
                <td><input type="text" id="codigo" required></td>
            </tr>
            <tr>
                <td><label for="nombre">Nombre:</label></td>
                <td><input type="text" id="nombre" required></td>
            </tr>
            <tr>
                <td><label for="talles">Talles (separados por coma):</label></td>
                <td><input type="text" id="talles" required></td>
            </tr>
            <tr>
                <td><label for="colores">Colores (separados por coma):</label></td>
                <td><input type="text" id="colores" required></td>
            </tr>
            <tr>
                <td><label for="urls">URLs (separadas por coma):</label></td>
                <td><input type="text" id="urls" required></td>
            </tr>
            <tr>
                <td><label for="cantidad_stock_proveedor">Cantidad Stock:</label></td>
                <td><input type="number" id="cantidad_stock_proveedor" required min="0"></td>
            </tr>
            <tr>
                <td colspan="2" style="text-align: center;">
                    <button type="submit">Dar de alta producto</button>
                </td>
            </tr>
        </table>
    </form>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Código</th>
                <th>Cantidad Stock</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody id="productos-table-body">
            <!-- Aquí se llenarán los productos dinámicamente -->
        </tbody>
    </table>

    <script>
        // Función para obtener los productos y llenar la tabla
        async function fetchProductos() {
            const response = await fetch('/productos'); // URL del endpoint
            const productos = await response.json();

            const tableBody = document.getElementById('productos-table-body');
            tableBody.innerHTML = ''; // Limpiar tabla

            productos.forEach(producto => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${producto.id}</td>
                    <td>${producto.nombre}</td>
                    <td>${producto.codigo}</td>
                    <td>
                        <input type="number" id="cantidad-${producto.id}" value="${producto.cantidad_stock_proveedor}" min="0">
                    </td>
                    <td><button onclick="modificarStock(${producto.id})">Actualizar</button></td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Función para modificar la cantidad de stock de un producto
        async function modificarStock(productoId) {
            const nuevaCantidad = document.getElementById(`cantidad-${productoId}`).value;

            const response = await fetch('/productos/modificar', { // URL del endpoint para modificar
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    producto_id: productoId,
                    nueva_cantidad: nuevaCantidad
                })
            });

            if (response.ok) {
                alert(`Stock del producto ${productoId} actualizado a ${nuevaCantidad}`);
                await fetchProductos(); // Refrescar los productos
            } else {
                alert('Error al actualizar el stock del producto');
            }
        }

        // Función para dar de alta un nuevo producto
        async function darDeAltaProducto(event) {
            event.preventDefault(); // Prevenir el envío del formulario

            const codigo = document.getElementById('codigo').value;
            const nombre = document.getElementById('nombre').value;
            const talles = document.getElementById('talles').value.split(',');
            const colores = document.getElementById('colores').value.split(',');
            const urls = document.getElementById('urls').value.split(',');
            const cantidad_stock_proveedor = document.getElementById('cantidad_stock_proveedor').value;

            const nuevoProducto = {
                codigo,
                nombre,
                talles,
                colores,
                urls,
                cantidad_stock_proveedor // Añadir cantidad_stock_proveedor al nuevo producto
            };

            const response = await fetch('/productos/alta', { // URL del endpoint para dar de alta
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(nuevoProducto)
            });

            if (response.ok) {
                alert('Producto dado de alta exitosamente');
                await fetchProductos(); // Refrescar los productos
            } else {
                alert('Error al dar de alta el producto');
            }

            // Limpiar el formulario
            document.getElementById('alta-producto-form').reset();
        }

        // Asignar el evento de envío del formulario
        document.getElementById('alta-producto-form').addEventListener('submit', darDeAltaProducto);

        // Llamar a fetchProductos cuando se cargue la página
        window.onload = fetchProductos;
    </script>
</body>

</html>
